version: '3.4'

# # TO USE THIS FILE, FIRST UNCOMMENT THE FOLLOWING LINE ('services:')

services:

# # THEN UNCOMMENT ONLY THE SECTION OR SECTIONS CONTAINING THE CHANGES YOU WANT TO APPLY
# # SAVE THIS FILE AS 'docker-compose.override.yaml'
# # AND USE THE 'docker-compose build' & 'docker-compose up -d' COMMANDS AS YOU WOULD NORMALLY DO

# # BUILD FROM LATEST IMAGE
  api:
    volumes:
      - /volume1/docker/librechat/data/.env:/app/.env
      - /volume1/docker/librechat/data/images:/app/client/public/images
      - /volume1/docker/librechat/data/uploads:/app/uploads
      - /volume1/docker/librechat/data/logs:/app/logs
  mongodb:
    container_name: chat-mongodb
    image: mongo:4.2
    restart: always
    user: "${UID}:${GID}"
    volumes:
      - /volume1/docker/librechat/data-node:/data/db
    command: mongod --noauth

# # USE MONGODB V4.4.18 - FOR OLDER CPU WITHOUT AVX SUPPORT
#   mongodb:
#     image: mongo:4.4.18

# # DISABLE THE MONGODB CONTAINER - YOU NEED TO SET AN ALTERNATIVE MONGODB URI IN THE .ENV FILE
#   api:
#     environment:
#       - MONGO_URI=${MONGO_URI}
#   mongodb:
#     image: tianon/true
#     command: ""
#     entrypoint: ""

# # EXPOSE MONGODB PORTS - USE CAREFULLY, THIS MAKES YOUR DATABASE VULNERABLE TO ATTACKS
#   mongodb:
#     ports:
#       - 27018:27017

# # DISABLE MEILISEARCH
  meilisearch:
#     profiles:
#       - donotstart
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - /volume1/docker/librechat/meili_data_v1.12:/meili_data
  rag_api:
    env_file:
      - /volume1/docker/librechat/data/.env

# # EXPOSE MEILISEARCH PORTS - DO NOT USE THE DEFAULT VALUE FOR THE MASTER KEY IF YOU DO THIS
#   meilisearch:
#     ports:
#       - 7700:7700
